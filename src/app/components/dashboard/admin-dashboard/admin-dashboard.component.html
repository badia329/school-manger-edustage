<app-banner title="Admin Dashboard"></app-banner>
<div class="dashboard-container">
  <!-- Page Title -->
  <div class="row mb-4">
    <div class="col-12">
      <p class="text-muted">Manage students, teachers and courses</p>
    </div>
  </div>

  <!-- Main Content Tabs -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs" role="tablist">
            <li class="nav-item">
              <button
                class="nav-link active"
                data-bs-toggle="tab"
                data-bs-target="#students-tab"
              >
                <i class="fas fa-user-graduate me-2"></i>Students
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link"
                data-bs-toggle="tab"
                data-bs-target="#teachers-tab"
              >
                <i class="fas fa-chalkboard-teacher me-2"></i>Teachers
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link"
                data-bs-toggle="tab"
                data-bs-target="#courses-tab"
              >
                <i class="fas fa-book me-2"></i>Courses
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link"
                data-bs-toggle="tab"
                data-bs-target="#assign-tab"
              >
                <i class="fas fa-link me-2"></i>Assign Students
              </button>
            </li>
          </ul>
        </div>

        <div class="card-body">
          <div class="tab-content">
            <!-- Students Tab -->
            <div class="tab-pane fade show active" id="students-tab">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h5 class="mb-0">All Students</h5>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Search students..."
                  style="width: 250px"
                />
              </div>

              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Address</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let student of students">
                      <td>{{ student.id }}</td>
                      <td>
                        <div class="d-flex align-items-center">
                          <span
                            >{{ student.firstName }}
                            {{ student.lastName }}</span
                          >
                        </div>
                      </td>
                      <td>{{ student.email }}</td>
                      <td>{{ student.tel }}</td>
                      <td>{{ student.address }}</td>
                      <td>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-primary me-1"
                        >
                          <i class="fas fa-eye"></i> View
                        </button>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-danger"
                          (click)="deleteUser(student.id)"
                        >
                          <i class="fas fa-trash"></i> Delete
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Teachers Tab -->
            <div class="tab-pane fade" id="teachers-tab">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h5 class="mb-0">All Teachers</h5>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Search teachers..."
                  style="width: 250px"
                />
              </div>

              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Specialty</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let teacher of teachers">
                      <td>{{ teacher.id }}</td>
                      <td>
                        <div class="d-flex align-items-center">
                          <span
                            >{{ teacher.firstName }}
                            {{ teacher.lastName }}</span
                          >
                        </div>
                      </td>
                      <td>{{ teacher.address }}</td>
                      <td>{{ teacher.tel }}</td>
                      <td>
                        <span class="badge bg-primary">{{
                          teacher.specialty
                        }}</span>
                      </td>
                      <td>
                        <span
                          [class]="
                            teacher.isValidated
                              ? 'badge bg-success'
                              : 'badge bg-danger'
                          "
                        >
                          {{
                            teacher.isValidated ? "Validated" : "Not Validated"
                          }}
                        </span>
                      </td>
                      <td>
                        <button
                          *ngIf="!teacher.isValidated"
                          class="btn btn-sm btn-success me-1"
                          (click)="validateTeacher(teacher.id)"
                        >
                          <i class="fas fa-check me-1"></i>Validate
                        </button>

                        <button
                          class="btn btn-sm btn-danger"
                          (click)="deleteUser(teacher.id)"
                        >
                          <i class="fas fa-times me-1"></i>Delete
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Courses Tab -->
            <div class="tab-pane fade" id="courses-tab">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h5 class="mb-0">All Courses</h5>
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Search courses..."
                  style="width: 250px"
                />
              </div>

              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Course Name</th>
                      <th>Description</th>
                      <th>Duration</th>
                      <th>Teacher</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let course of courses">
                      <td>
                        <strong>{{ course.type }}</strong>
                      </td>
                      <td>{{ course.description }}</td>
                      <td>{{ course.duration }}</td>
                      <td>{{ getTeacherName(course.teacherId) }}</td>
                      <td>
                        <button
                          (click)="infoCourse(course.idCourse)"
                          class="btn btn-sm btn-outline-primary me-1"
                        >
                          <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-sm btn-outline-danger">
                          <i class="fas fa-trash"></i> Delete
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Assign Students Tab -->
            <div class="tab-pane fade" id="assign-tab">
              <h5 class="mb-4">Assign Students to Course</h5>

              <div class="row">
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Teacher</label>
                    <select
                      class="form-select"
                      [(ngModel)]="selectedTeacherId"
                      (change)="onTeacherChange()"
                    >
                      <option value="" selected disabled>
                        Choose teacher...
                      </option>
                      <option
                        *ngFor="let teacher of teachers"
                        [value]="teacher.id"
                      >
                        {{ teacher.firstName }} {{ teacher.lastName }}
                      </option>
                    </select>
                  </div>

                  <div class="mb-3">
                    <label class="form-label">Course</label>
                    <select class="form-select" [(ngModel)]="selectedCourseId">
                      <option value="" selected disabled>
                        Choose course...
                      </option>
                      <option
                        *ngFor="let course of filteredCourses"
                        [value]="course.idCourse"
                      >
                        {{ course.type }} ({{ course.name }})
                      </option>
                    </select>
                    <small
                      class="text-danger"
                      *ngIf="selectedTeacherId && filteredCourses.length === 0"
                    >
                      This teacher has no assigned courses yet.
                    </small>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header bg-success text-white">
                      <h6 class="mb-0">Select Students</h6>
                    </div>
                    <div class="card-body">
                      <div class="mb-3">
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Search students..."
                        />
                      </div>

                      <div
                        class="student-list"
                        style="max-height: 300px; overflow-y: auto"
                      >
                        <div
                          class="form-check mb-2"
                          *ngFor="let student of students"
                        >
                          <input
                            class="form-check-input"
                            type="checkbox"
                            [id]="'student' + student.id"
                            [(ngModel)]="student.selected"
                          />
                          <label
                            class="form-check-label"
                            [for]="'student' + student.id"
                          >
                            {{ student.firstName }} {{ student.lastName }} - #{{
                              student.id
                            }}
                          </label>
                        </div>

                        <div class="text-muted" *ngIf="students.length === 0">
                          No students found.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="text-center mt-4">
                <button
                  class="btn btn-primary btn-lg"
                  (click)="assignStudents()"
                >
                  Assign Students to Course
                </button>
              </div>

              <!-- Current Assignments -->
              <!-- <div class="mt-5">
                <h5 class="mb-3">Current Course Assignments</h5>
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th>Course</th>
                        <th>Teacher</th>
                        <th>Assigned Students</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of allAssignments">
                        <td>{{ item.courseName }}</td>
                        <td>{{ item.teacherName }}</td>
                        <td>
                          <span
                            class="badge bg-info me-1"
                            *ngFor="let stdName of item.students"
                          >
                            {{ stdName }}
                          </span>
                        </td>
                        <td>
                          <button
                            class="btn btn-sm btn-outline-danger"
                            (click)="deleteAssignment(item.id)"
                          >
                            <i class="fas fa-trash"></i> Delete
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
